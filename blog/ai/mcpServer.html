<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä½¿ç”¨ MCP + DeepSeek + OpenWeatherMap æ„å»ºæ™ºèƒ½å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨ | shadow</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/blog/assets/css/0.styles.0b1ac558.css" as="style"><link rel="preload" href="/blog/assets/js/app.faaa4d6f.js" as="script"><link rel="preload" href="/blog/assets/js/2.50ac7f95.js" as="script"><link rel="preload" href="/blog/assets/js/8.bfde39e2.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d206cb63.js"><link rel="prefetch" href="/blog/assets/js/11.e907298b.js"><link rel="prefetch" href="/blog/assets/js/12.136eb064.js"><link rel="prefetch" href="/blog/assets/js/13.3e9ac2b3.js"><link rel="prefetch" href="/blog/assets/js/14.eb559736.js"><link rel="prefetch" href="/blog/assets/js/15.beccba6e.js"><link rel="prefetch" href="/blog/assets/js/16.af5150ff.js"><link rel="prefetch" href="/blog/assets/js/17.dbf952d1.js"><link rel="prefetch" href="/blog/assets/js/18.c318f18c.js"><link rel="prefetch" href="/blog/assets/js/19.42fddf42.js"><link rel="prefetch" href="/blog/assets/js/20.a057d148.js"><link rel="prefetch" href="/blog/assets/js/21.3b99ccf6.js"><link rel="prefetch" href="/blog/assets/js/22.ef7b4cd0.js"><link rel="prefetch" href="/blog/assets/js/23.e3a34ba1.js"><link rel="prefetch" href="/blog/assets/js/3.6eb4007c.js"><link rel="prefetch" href="/blog/assets/js/4.1b609518.js"><link rel="prefetch" href="/blog/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/blog/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/blog/assets/js/7.8a5eaf01.js"><link rel="prefetch" href="/blog/assets/js/9.7d91f5cb.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.0b1ac558.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">shadow</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/blog/element/element" class="sidebar-heading clickable"><span>elementç›¸å…³</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/element/element.html" class="sidebar-link">ç©¿é€æ›´æ”¹element</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/babel" class="sidebar-heading clickable"><span>babelç›¸å…³</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/babel/babel-plugin-remove-module.html" class="sidebar-link">babel-plugin-remove-module</a></li><li><a href="/blog/blog/babel/babel-plugin-auto-report-error.html" class="sidebar-link">babel-plugin-auto-report-error</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/vue" class="sidebar-heading clickable"><span>vueæºç ç›¸å…³</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/vue/vue2-lifecycle.html" class="sidebar-link">vue2-lifecycleæºç è§£æ</a></li><li><a href="/blog/blog/vue/vue2-computed.html" class="sidebar-link">vue2computedæºç è§£æ</a></li><li><a href="/blog/blog/vue/vue2-watch.html" class="sidebar-link">vue2watchæºç è§£æ</a></li><li><a href="/blog/blog/vue/vue2-$set.html" class="sidebar-link">vue2$setæºç è§£æ</a></li><li><a href="/blog/blog/vue/vue2-mixin.html" class="sidebar-link">vue2mixinåˆå¹¶ç­–ç•¥è§£æ</a></li><li><a href="/blog/blog/vue/vue2-vue3-reactive-compare.html" class="sidebar-link">vue2/vue3å“åº”å¼å˜æ›´å¯¹æ¯”</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/daily" class="sidebar-heading clickable"><span>æ—¥å¸¸è®°å½•</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/daily/build-optimization.html" class="sidebar-link">webpackæ‰“åŒ…ä¼˜åŒ–</a></li><li><a href="/blog/blog/daily/control-request.html" class="sidebar-link">æ§åˆ¶é‡å¤è¯·æ±‚,å¹¶è¿”å›åŒæ®µæ—¶é—´å†…çš„è¯·æ±‚ç»“æœ</a></li><li><a href="/blog/blog/daily/team-rule.html" class="sidebar-link">å›¢é˜Ÿä»£ç è§„èŒƒ</a></li><li><a href="/blog/blog/daily/vue+docker+jenkins.html" class="sidebar-link">vue+docker+jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²</a></li><li><a href="/blog/blog/daily/whistle.html" class="sidebar-link">å¼€å‘å·¥å…·-whistle</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/ai" class="sidebar-heading clickable router-link-active open"><span>ai</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/ai/mcpServer.html" aria-current="page" class="active sidebar-link">å¼€å‘mcp server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#æŠ€æœ¯æ ˆç®€ä»‹" class="sidebar-link">æŠ€æœ¯æ ˆç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#å¼•å…¥mcpç›¸å…³çš„ç¬¬ä¸‰æ–¹ä¾èµ–" class="sidebar-link">å¼•å…¥mcpç›¸å…³çš„ç¬¬ä¸‰æ–¹ä¾èµ–</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#æ³¨å†Œå·¥å…·-getweather" class="sidebar-link">æ³¨å†Œå·¥å…·ï¼šgetWeather</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#ai-ç†è§£ç”¨æˆ·æ„å›¾-åŸå¸‚åæå–" class="sidebar-link">AI ç†è§£ç”¨æˆ·æ„å›¾ï¼ˆåŸå¸‚åæå–ï¼‰</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#è°ƒç”¨å¤©æ°”-api" class="sidebar-link">è°ƒç”¨å¤©æ°” API</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#ç”¨-deepseek-ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤" class="sidebar-link">ç”¨ DeepSeek ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#å¯åŠ¨-mcp-æœåŠ¡å™¨" class="sidebar-link">å¯åŠ¨ MCP æœåŠ¡å™¨</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#é¡¹ç›®è¿è¡Œæ­¥éª¤" class="sidebar-link">é¡¹ç›®è¿è¡Œæ­¥éª¤</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#ç»“æœ" class="sidebar-link">ç»“æœ</a></li><li class="sidebar-sub-header"><a href="/blog/blog/ai/mcpServer.html#å®Œæ•´ä»£ç " class="sidebar-link">å®Œæ•´ä»£ç </a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ä½¿ç”¨-mcp-deepseek-openweathermap-æ„å»ºæ™ºèƒ½å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨"><a href="#ä½¿ç”¨-mcp-deepseek-openweathermap-æ„å»ºæ™ºèƒ½å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨" class="header-anchor">#</a> ä½¿ç”¨ MCP + DeepSeek + OpenWeatherMap æ„å»ºæ™ºèƒ½å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨</h1> <p>æœ¬æ–‡ä¸»è¦æ˜¯è‡ªå·±å­¦ä¹ å¼€å‘mcp serverçš„ä¸€ç¯‡æ–‡ç« ï¼Œä¸»è¦æ˜¯åŸºäº <strong>Model Context Protocolï¼ˆMCPï¼‰</strong> ä¸ <strong>DeepSeek</strong> æ¨¡å‹çš„æ™ºèƒ½å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨ï¼Œ
å®ƒèƒ½å¤Ÿç†è§£ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€ï¼Œä»ä¸­æå–åŸå¸‚åï¼Œå¹¶è°ƒç”¨ <strong>OpenWeatherMap API</strong> è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ï¼Œæœ€åç”±å¤§æ¨¡å‹ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤</p> <hr> <h2 id="æŠ€æœ¯æ ˆç®€ä»‹"><a href="#æŠ€æœ¯æ ˆç®€ä»‹" class="header-anchor">#</a> æŠ€æœ¯æ ˆç®€ä»‹</h2> <p>è¿™æ®µä»£ç ä¸»è¦ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯ï¼š</p> <table><thead><tr><th>æŠ€æœ¯</th> <th>ç”¨é€”</th></tr></thead> <tbody><tr><td><strong>MCPï¼ˆModel Context Protocolï¼‰</strong></td> <td>ç”¨äºå®ç° AI åº”ç”¨çš„æœåŠ¡ç«¯é€šä¿¡åè®®ã€‚</td></tr> <tr><td><strong>DeepSeek</strong></td> <td>ä¸€ä¸ªå¼€æºçš„å¤šæ¨¡æ€å¤§è¯­è¨€æ¨¡å‹ï¼Œç”¨äºç†è§£å’Œç”Ÿæˆæ–‡æœ¬ã€‚</td></tr> <tr><td><strong>OpenWeatherMap API</strong></td> <td>æä¾›å®æ—¶å¤©æ°”æ•°æ®ã€‚</td></tr> <tr><td><strong>Axios</strong></td> <td>è´Ÿè´£å‘å¤–éƒ¨ API å‘èµ· HTTP è¯·æ±‚ã€‚</td></tr> <tr><td><strong>Zod</strong></td> <td>ç”¨äºå‚æ•°ç±»å‹å®šä¹‰å’Œæ ¡éªŒã€‚</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mcp-server&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;@types/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^22.10.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.7.2&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;@modelcontextprotocol/sdk&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.4.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.12.2&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;openai&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.3.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div><hr> <h2 id="å¼•å…¥mcpç›¸å…³çš„ç¬¬ä¸‰æ–¹ä¾èµ–"><a href="#å¼•å…¥mcpç›¸å…³çš„ç¬¬ä¸‰æ–¹ä¾èµ–" class="header-anchor">#</a> å¼•å…¥mcpç›¸å…³çš„ç¬¬ä¸‰æ–¹ä¾èµ–</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> McpServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modelcontextprotocol/sdk/server/mcp.js&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> <span class="token punctuation">{</span> StdioServerTransport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> z <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zod&quot;</span><span class="token punctuation">;</span> <span class="token comment">// åšè¾“å…¥æ ¡éªŒ</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OpenAI <span class="token keyword">from</span> <span class="token string">&quot;openai&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»º DeepSeek å®¢æˆ·ç«¯</span>
<span class="token keyword">const</span> openai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenAI</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">'https://api.deepseek.com'</span><span class="token punctuation">,</span> <span class="token comment">// deepseekä¸Šé¢æ‰¾çš„</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»º MCP æœåŠ¡å™¨å®ä¾‹</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">McpServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;TimeServer&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="æ³¨å†Œå·¥å…·-getweather"><a href="#æ³¨å†Œå·¥å…·-getweather" class="header-anchor">#</a> æ³¨å†Œå·¥å…·ï¼šgetWeather</h2> <p>é€šè¿‡ <code>server.tool()</code> æ³¨å†Œä¸€ä¸ªåä¸º <strong>getWeather</strong> çš„å·¥å…·ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">tool</span><span class="token punctuation">(</span><span class="token string">&quot;getWeather&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å®æ—¶å¤©æ°”ä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">prompt</span><span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;è¦æŸ¥è¯¢çš„åŸå¸‚åï¼Œä¾‹å¦‚ Beijing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> prompt <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</code></pre></div><h3 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="header-anchor">#</a> å‚æ•°è¯´æ˜ï¼š</h3> <ul><li><code>getWeather</code>ï¼šå·¥å…·åç§°ã€‚</li> <li><code>&quot;æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å®æ—¶å¤©æ°”ä¿¡æ¯&quot;</code>ï¼šæè¿°ã€‚</li> <li><code>zod</code> æ¨¡å¼å®šä¹‰äº†è¾“å…¥å‚æ•° <code>prompt</code>ï¼Œå³ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€ï¼ˆä¾‹å¦‚ â€œå¸®æˆ‘æŸ¥ä¸‹åŒ—äº¬çš„å¤©æ°”â€ï¼‰ã€‚</li></ul> <hr> <h2 id="ai-ç†è§£ç”¨æˆ·æ„å›¾-åŸå¸‚åæå–"><a href="#ai-ç†è§£ç”¨æˆ·æ„å›¾-åŸå¸‚åæå–" class="header-anchor">#</a> AI ç†è§£ç”¨æˆ·æ„å›¾ï¼ˆåŸå¸‚åæå–ï¼‰</h2> <p>ç¬¬ä¸€æ­¥æ˜¯è®© <strong>DeepSeek æ¨¡å‹</strong> è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œä»ä¸­æå–å‡ºåŸå¸‚åã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> intentPrompt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
ä½ æ˜¯ä¸€ä¸ªæ„å›¾åˆ†æåŠ©æ‰‹ã€‚ç”¨æˆ·è¾“å…¥æ˜¯è‡ªç„¶è¯­è¨€ï¼Œè¯·ä»ä¸­æå–â€œåŸå¸‚åâ€ã€‚
åªè¿”å›åŸå¸‚åï¼ˆå¦‚ Beijingã€Shanghai,Guangzhou, åŒ—äº¬ï¼Œä¸Šæµ·ï¼Œå¹¿å·ï¼‰ï¼Œä¸è¦è§£é‡Šã€‚
å¦‚æœæ— æ³•ç¡®å®šï¼Œè¯·è¿”å›â€œæœªçŸ¥â€ã€‚
ç”¨æˆ·è¾“å…¥ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prompt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> aiResult <span class="token operator">=</span> <span class="token keyword">await</span> openai<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;ä½ æ˜¯ä¸€ä¸ªç®€æ´çš„æå–åŠ©æ‰‹ã€‚&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> intentPrompt <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token string">&quot;deepseek-chat&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p> <ul><li>æ¨¡å‹è§’è‰²åˆ†ä¸ºï¼š
<ul><li><code>system</code>ï¼šè®¾å®šæ¨¡å‹è¡Œä¸ºã€‚</li> <li><code>user</code>ï¼šæä¾›æŒ‡ä»¤å†…å®¹ã€‚</li></ul></li> <li>æ¨¡å‹è¾“å‡º <code>aiResult.choices[0].message.content</code>ï¼Œå³è¯†åˆ«å‡ºçš„åŸå¸‚åã€‚</li></ul> <p>å¦‚æœæ— æ³•æå–åŸå¸‚åï¼Œåˆ™è¿”å›â€œæœªçŸ¥â€ã€‚</p> <hr> <h2 id="è°ƒç”¨å¤©æ°”-api"><a href="#è°ƒç”¨å¤©æ°”-api" class="header-anchor">#</a> è°ƒç”¨å¤©æ°” API</h2> <p>å½“åŸå¸‚åè¯†åˆ«æˆåŠŸåï¼Œç¨‹åºä¼šè°ƒç”¨ <strong>OpenWeatherMap API</strong> è·å–è¯¥åŸå¸‚çš„å®æ—¶å¤©æ°”ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> apiKey <span class="token operator">=</span> <span class="token string">&quot;å¡«å†™ä½ çš„apiKey,è¦å»OpenWeatherMapç”³è¯·&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.openweathermap.org/data/2.5/weather?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>apiKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;lang=zh_cn&amp;units=metric</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> weatherResponse <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p> <ul><li><code>q</code>ï¼šæŸ¥è¯¢åŸå¸‚ã€‚</li> <li><code>appid</code>ï¼šAPI å¯†é’¥ã€‚</li> <li><code>lang=zh_cn</code>ï¼šè¿”å›ä¸­æ–‡å¤©æ°”æè¿°ã€‚</li> <li><code>units=metric</code>ï¼šä½¿ç”¨æ‘„æ°åº¦ã€‚</li></ul> <p>éšåæ‹¼æ¥å¤©æ°”æ‘˜è¦ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> summary <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ç°åœ¨</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">çš„å¤©æ°”æ˜¯</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>weather<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ï¼Œ
æ¸©åº¦</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>main<span class="token punctuation">.</span>temp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Â°Cï¼Œæ¹¿åº¦</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>main<span class="token punctuation">.</span>humidity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">% ï¼Œ
é£é€Ÿ</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>wind<span class="token punctuation">.</span>speed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ç±³æ¯ç§’ã€‚</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="ç”¨-deepseek-ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤"><a href="#ç”¨-deepseek-ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤" class="header-anchor">#</a> ç”¨ DeepSeek ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤</h2> <p>ä¸ºäº†è®©è¿”å›ç»“æœæ›´åŠ è‡ªç„¶å’Œäººæ€§åŒ–ï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨ <strong>DeepSeek æ¨¡å‹</strong>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> chatPrompt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
ä½ æ˜¯ä¸€ä½å¤©æ°”åŠ©æ‰‹ï¼Œç”¨è‡ªç„¶å¯¹è¯çš„æ–¹å¼å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚
è¯·ç”¨æ¸©å’Œè‡ªç„¶çš„è¯­æ°”å›ç­”ä»¥ä¸‹å†…å®¹ï¼Œä¸è¦åªæ˜¯ç½—åˆ—æ•°æ®ã€‚

ç”¨æˆ·çš„é—®é¢˜ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prompt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
å¤©æ°”æ•°æ®ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>summary<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> completion <span class="token operator">=</span> <span class="token keyword">await</span> openai<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„ä¸­æ–‡å¤©æ°”åŠ©ç†ã€‚&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> chatPrompt <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token string">&quot;deepseek-chat&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è¾“å‡ºç»“æœå³ä¸ºè‡ªç„¶è¯­è¨€å›å¤ï¼Œä¾‹å¦‚ï¼š</p> <blockquote><p>â€œä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ™´æœ—ï¼Œæ°”æ¸©å¤§çº¦ 26Â°Cï¼Œé£ä¸å¤§ï¼Œé€‚åˆå¤–å‡ºã€‚â€</p></blockquote> <p>æœ€ç»ˆè¿”å›ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> completion<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="å¯åŠ¨-mcp-æœåŠ¡å™¨"><a href="#å¯åŠ¨-mcp-æœåŠ¡å™¨" class="header-anchor">#</a> å¯åŠ¨ MCP æœåŠ¡å™¨</h2> <p>æœ€åï¼Œé€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡ºé€šé“å¯åŠ¨æœåŠ¡å™¨ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ­£åœ¨å¯åŠ¨ MCP æ—¶é—´æœåŠ¡å™¨...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> transport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdioServerTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>transport<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;MCP æ—¶é—´æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…è¯·æ±‚...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨æœåŠ¡å™¨æ—¶å‡ºé”™:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">startServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="é¡¹ç›®è¿è¡Œæ­¥éª¤"><a href="#é¡¹ç›®è¿è¡Œæ­¥éª¤" class="header-anchor">#</a> é¡¹ç›®è¿è¡Œæ­¥éª¤</h2> <p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰§è¡Œå®Œæˆåä¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•æˆ‘ä»¬çš„mcp server http://localhost:6274/?MCP_PROXY_AUTH_TOKEN=xxx#tools</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx @modelcontextprotocol/inspector <span class="token function">node</span> index.js
</code></pre></div><p>è¿è¡Œåç»ˆç«¯è¾“å‡ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>æ­£åœ¨å¯åŠ¨ MCP æ—¶é—´æœåŠ¡å™¨...
MCP æ—¶é—´æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…è¯·æ±‚...
</code></pre></div><h2 id="ç»“æœ"><a href="#ç»“æœ" class="header-anchor">#</a> ç»“æœ</h2> <p><img src="https://yuanlifang.oss-cn-shenzhen.aliyuncs.com/2433ab4c-563c-489d-8006-78f2ec662369-111.png" alt="images"></p> <h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="header-anchor">#</a> å®Œæ•´ä»£ç </h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> McpServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modelcontextprotocol/sdk/server/mcp.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StdioServerTransport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> z <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;zod&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> OpenAI <span class="token keyword">from</span> <span class="token string">&quot;openai&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> openai <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OpenAI</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">'https://api.deepseek.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">McpServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;TimeServer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æœåŠ¡å™¨åç§°</span>
  <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span> <span class="token comment">// æœåŠ¡å™¨ç‰ˆæœ¬</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">tool</span><span class="token punctuation">(</span><span class="token string">&quot;getWeather&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å®æ—¶å¤©æ°”ä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">prompt</span><span class="token operator">:</span> z
      <span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">optional</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">describe</span><span class="token punctuation">(</span>
        <span class="token string">&quot;è¦æŸ¥è¯¢çš„åŸå¸‚åï¼Œä¾‹å¦‚ Beijing&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> prompt <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‹¼æ¥APIè¯·æ±‚URL</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// ğŸ§  ç¬¬1æ­¥ï¼šè°ƒç”¨ DeepSeek æ¨¡å‹ç†è§£ç”¨æˆ·æ„å›¾</span>
      <span class="token keyword">const</span> intentPrompt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
ä½ æ˜¯ä¸€ä¸ªæ„å›¾åˆ†æåŠ©æ‰‹ã€‚ç”¨æˆ·è¾“å…¥æ˜¯è‡ªç„¶è¯­è¨€ï¼Œè¯·ä»ä¸­æå–â€œåŸå¸‚åâ€ã€‚
åªè¿”å›åŸå¸‚åï¼ˆå¦‚ Beijingã€Shanghai,Guangzhou, åŒ—äº¬ï¼Œä¸Šæµ·ï¼Œå¹¿å·ï¼‰ï¼Œä¸è¦è§£é‡Šã€‚
å¦‚æœæ— æ³•ç¡®å®šï¼Œè¯·è¿”å›â€œæœªçŸ¥â€ã€‚
ç”¨æˆ·è¾“å…¥ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prompt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> aiResult <span class="token operator">=</span> <span class="token keyword">await</span> openai<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;ä½ æ˜¯ä¸€ä¸ªç®€æ´çš„æå–åŠ©æ‰‹ã€‚&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> intentPrompt <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token string">&quot;deepseek-chat&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'aiResult'</span><span class="token punctuation">,</span>aiResult<span class="token punctuation">)</span>
      <span class="token keyword">const</span> city <span class="token operator">=</span> aiResult<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content <span class="token operator">||</span> <span class="token string">&quot;æœªçŸ¥&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>city <span class="token operator">===</span> <span class="token string">&quot;æœªçŸ¥&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&quot;æŠ±æ­‰ï¼Œæˆ‘æ²¡èƒ½ç†è§£ä½ è¦æŸ¥è¯¢å“ªä¸ªåŸå¸‚çš„å¤©æ°”ã€‚&quot;</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> apiKey <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.openweathermap.org/data/2.5/weather?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>apiKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;lang=zh_cn&amp;units=metric</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

      <span class="token comment">// è°ƒç”¨OpenWeatherMap API</span>
      <span class="token keyword">const</span> weatherResponse <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'weatherResponse'</span><span class="token punctuation">,</span> weatherResponse<span class="token punctuation">)</span>
      <span class="token keyword">const</span> summary <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ç°åœ¨</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">çš„å¤©æ°”æ˜¯</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>weather<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ï¼Œæ¸©åº¦</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>main<span class="token punctuation">.</span>temp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Â°Cï¼Œæ¹¿åº¦</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>main<span class="token punctuation">.</span>humidity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">% ï¼Œé£é€Ÿ</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weatherResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>wind<span class="token punctuation">.</span>speed<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ç±³æ¯ç§’ã€‚</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token comment">// ğŸ’¬ ç¬¬3æ­¥ï¼šè°ƒç”¨ DeepSeek ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤</span>
      <span class="token keyword">const</span> chatPrompt <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
ä½ æ˜¯ä¸€ä½å¤©æ°”åŠ©æ‰‹ï¼Œç”¨è‡ªç„¶å¯¹è¯çš„æ–¹å¼å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚
è¯·ç”¨æ¸©å’Œè‡ªç„¶çš„è¯­æ°”å›ç­”ä»¥ä¸‹å†…å®¹ï¼Œä¸è¦åªæ˜¯ç½—åˆ—æ•°æ®ã€‚

ç”¨æˆ·çš„é—®é¢˜ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prompt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
å¤©æ°”æ•°æ®ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>summary<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>


      <span class="token keyword">const</span> completion <span class="token operator">=</span> <span class="token keyword">await</span> openai<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&quot;ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„ä¸­æ–‡å¤©æ°”åŠ©ç†ã€‚&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> chatPrompt <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token string">&quot;deepseek-chat&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Model is:&quot;</span><span class="token punctuation">,</span> completion<span class="token punctuation">.</span>model<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Output is:&quot;</span><span class="token punctuation">,</span> completion<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// âœ… ç¬¬4æ­¥ï¼šè¿”å›æœ€ç»ˆç»“æœ</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> completion<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœAPIè°ƒç”¨å¤±è´¥</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">è·å–å¤©æ°”å¤±è´¥ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * å¯åŠ¨æœåŠ¡å™¨ï¼Œè¿æ¥åˆ°æ ‡å‡†è¾“å…¥/è¾“å‡ºä¼ è¾“
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ­£åœ¨å¯åŠ¨ MCP æ—¶é—´æœåŠ¡å™¨...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºæ ‡å‡†è¾“å…¥/è¾“å‡ºä¼ è¾“</span>
    <span class="token keyword">const</span> transport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StdioServerTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è¿æ¥æœåŠ¡å™¨åˆ°ä¼ è¾“</span>
    <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>transport<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;MCP æ—¶é—´æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç­‰å¾…è¯·æ±‚...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨æœåŠ¡å™¨æ—¶å‡ºé”™:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">startServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><hr> <hr></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/blog/daily/whistle.html" class="prev">
        å¼€å‘å·¥å…·-whistle
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.faaa4d6f.js" defer></script><script src="/blog/assets/js/2.50ac7f95.js" defer></script><script src="/blog/assets/js/8.bfde39e2.js" defer></script>
  </body>
</html>
