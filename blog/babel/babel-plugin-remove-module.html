<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是 babel | shadow</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/blog/assets/css/0.styles.dab10465.css" as="style"><link rel="preload" href="/blog/assets/js/app.4b9b75fb.js" as="script"><link rel="preload" href="/blog/assets/js/2.14ceba81.js" as="script"><link rel="preload" href="/blog/assets/js/9.b6e23a3a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.de8cd7e7.js"><link rel="prefetch" href="/blog/assets/js/11.26d74364.js"><link rel="prefetch" href="/blog/assets/js/12.012a359c.js"><link rel="prefetch" href="/blog/assets/js/13.e4f534b2.js"><link rel="prefetch" href="/blog/assets/js/14.bcf58a71.js"><link rel="prefetch" href="/blog/assets/js/15.3af46281.js"><link rel="prefetch" href="/blog/assets/js/16.a0447f5f.js"><link rel="prefetch" href="/blog/assets/js/17.e0a241c6.js"><link rel="prefetch" href="/blog/assets/js/18.fcd5b9c0.js"><link rel="prefetch" href="/blog/assets/js/19.c3d6410a.js"><link rel="prefetch" href="/blog/assets/js/20.70b582a9.js"><link rel="prefetch" href="/blog/assets/js/21.1012b884.js"><link rel="prefetch" href="/blog/assets/js/22.59e427b9.js"><link rel="prefetch" href="/blog/assets/js/23.661f4bb0.js"><link rel="prefetch" href="/blog/assets/js/24.d56f9f20.js"><link rel="prefetch" href="/blog/assets/js/25.076fae0c.js"><link rel="prefetch" href="/blog/assets/js/26.d72e970c.js"><link rel="prefetch" href="/blog/assets/js/27.bec24de7.js"><link rel="prefetch" href="/blog/assets/js/3.6d156057.js"><link rel="prefetch" href="/blog/assets/js/4.ed8f2e2d.js"><link rel="prefetch" href="/blog/assets/js/5.32dde0b2.js"><link rel="prefetch" href="/blog/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/blog/assets/js/7.f39602d3.js"><link rel="prefetch" href="/blog/assets/js/8.08134d9d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.dab10465.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">shadow</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/blog/blog/element/element" class="sidebar-heading clickable"><span>element相关</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/element/element.html" class="sidebar-link">穿透更改element</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/babel" class="sidebar-heading clickable router-link-active open"><span>babel相关</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/babel/babel-plugin-remove-module.html" aria-current="page" class="active sidebar-link">babel-plugin-remove-module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/blog/babel/babel-plugin-remove-module.html#什么是-babel" class="sidebar-link">什么是 babel</a></li><li class="sidebar-sub-header"><a href="/blog/blog/babel/babel-plugin-remove-module.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/blog/blog/babel/babel-plugin-remove-module.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/blog/blog/babel/babel-plugin-auto-report-error.html" class="sidebar-link">babel-plugin-auto-report-error</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/vue" class="sidebar-heading clickable"><span>vue源码相关</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/vue/vue2-lifecycle.html" class="sidebar-link">vue2-lifecycle源码解析</a></li><li><a href="/blog/blog/vue/vue2-computed.html" class="sidebar-link">vue2computed源码解析</a></li><li><a href="/blog/blog/vue/vue2-watch.html" class="sidebar-link">vue2watch源码解析</a></li><li><a href="/blog/blog/vue/vue2-$set.html" class="sidebar-link">vue2$set源码解析</a></li><li><a href="/blog/blog/vue/vue2-mixin.html" class="sidebar-link">vue2mixin合并策略解析</a></li><li><a href="/blog/blog/vue/vue2-vue3-reactive-compare.html" class="sidebar-link">vue2/vue3响应式变更对比</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/mini-program" class="sidebar-heading clickable"><span>微信小程序</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/mini-program/sensors.html" class="sidebar-link">神策</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/blog/blog/daily" class="sidebar-heading clickable"><span>日常记录</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/daily/build-optimization.html" class="sidebar-link">webpack打包优化</a></li><li><a href="/blog/blog/daily/control-request.html" class="sidebar-link">控制重复请求,并返回同段时间内的请求结果</a></li><li><a href="/blog/blog/daily/team-rule.html" class="sidebar-link">团队代码规范</a></li><li><a href="/blog/blog/daily/vue+docker+jenkins.html" class="sidebar-link">vue+docker+jenkins自动化部署</a></li><li><a href="/blog/blog/daily/whistle.html" class="sidebar-link">开发工具-whistle</a></li><li><a href="/blog/blog/daily/pnpm-monorepo-vue.html" class="sidebar-link">pnpm-monorepo-vue环境搭建</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="什么是-babel"><a href="#什么是-babel" class="header-anchor">#</a> 什么是 babel</h2> <p>Babel 是一个 JavaScript 编译器.Babel 是一个工具链，可以用于将 ECMAScript 2015+ 语法编写的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中
下面大致列出的是 Babel 能为你做的事情: 1.语法转换 2.通过 Polyfill 方式在目标环境中添加缺失的特性 3.源码转换</p> <p>比如我们用 vuecli 生成的项目,默认都是配置好一些开箱即用的插件(比如@vue/babel-preset-app),所以我们可以写很多一些新语法. 比如 ?. (可选链操作符) ?? (空值合并操作符) ...<br>
babel 是如何转换代码的</p> <h3 id="babel-转换代码大致过程有三步"><a href="#babel-转换代码大致过程有三步" class="header-anchor">#</a> babel 转换代码大致过程有三步</h3> <ol><li>parse</li></ol> <p>源代码 code -&gt; ast
这里有两个步骤
词法分析和语法分析
词法分析:就是把字符串形式的代码转换为令牌(tokens)流.也就是类似于下面的这种形式
源码:const code = 'hello babel'
[
{type: {...}, value: &quot;const&quot;},
{type: {...}, value: &quot;code&quot;},
{type: {...}, value: &quot;=&quot;},
{type: {...}, value: &quot;hello babel&quot;},
]</p> <p>语法分析:就是把令牌(tokens)流转换成 ast 的形式.</p> <p>Babel 的 parser 是基于 acorn 实现的.Babel 是基于 esTree 标准并且 Babel 基于 acorn 插件对 estree 的 ast 进行了一些扩展.从转换后的 ast 可以看出,代码被转换后会呈现出一个 tree 结构.每一层级都清晰了描述了代码的位置结构.然后每一层级中都有 type 属性,它告诉我们当前的节点是什么类型.
在转换成 ast 的代码中,会出现很多节点类型,如果想要了解它们可以查看 babel 官网的说明@babel/types.它可以创建和判断 AST 节点.
简单的介绍一些比较常用的类型说明
VariableDeclaration（变量声明）var a = 10;
FunctionDeclaration（函数声明）function fn() {}
FunctionExpression（函数表达式）var fn = function() {}
CallExpression（调用表达式）fn()
MemberExpression（成员表达式）user.name
BlockStatement（块）{}
Identifier（变量标识符）var a(a 就是 Identifier)
...</p> <p>在 parse 阶段我们可以使用 babel 提供的工具@babel/parser,来对代码进行解析进而生成 ast</p> <hr> <ol start="2"><li>transform:</li></ol> <p>对 ast 进行增删改...的操作</p> <p>transform 阶段可以使用 babel 提供的工具@babel/traverse,这个主要是对 ast 进行遍历,遍历过程中会提供一些特定节点类型的回调函数提供给用户.
然后我们就可以操作对应节点类型的 ast,从而来修改代码.</p> <hr> <ol start="3"><li>generate:</li></ol> <p>将 ast 重新生成回源代码
generate 阶段可以使用 babel 提供的工具@babel/generator.</p> <p>babel 也提供了@babel/core,这个插件包含了很多插件在内,包括上面说的三个插件.</p> <p>ast 结构的简单讲解</p> <p>在线转 ast 工具
本次演示工具所对应的版本</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;@babel/parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.14.4&quot;</span>
<span class="token string-property property">&quot;@babel/traverse&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.14.2&quot;</span>
<span class="token string-property property">&quot;@babel/generator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.14.3&quot;</span>
<span class="token string-property property">&quot;@babel/types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.14.4&quot;</span>
</code></pre></div><p>源代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sourceCode <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
   const code = 'hello babel'
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

转换成 ast 后

<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Program&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 程序根节点</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">27</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 程序体</span>
      <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 变量声明</span>
        <span class="token string-property property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 变量声明描述</span>
            <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">7</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">27</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 标识符</span>
              <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">7</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">11</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;identifierName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;code&quot;</span> <span class="token comment">// 变量名</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;code&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;StringLiteral&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 字符串字面量</span>
              <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">14</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">27</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;rawValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello babel&quot;</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;raw&quot;</span><span class="token operator">:</span> <span class="token string">&quot;'hello babel'&quot;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello babel&quot;</span> <span class="token comment">// 值</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;const&quot;</span> <span class="token comment">// 变量声明的关键字</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>每个节点属性中都有一些公共的属性,比如 type(类型),start(开始下标),end(结束下标),loc(记录开始和结束行列号)...</p> <p>从上面的结构中,删除一些无用的信息之后,我们的 tree 节点结构大致是这样的
-VariableDeclaration
-VariableDeclarator
-Identifier
-Literal</p> <p>ast 的遍历过程大致是这样的</p> <ul><li>进入(enter) VariableDeclaration
<ul><li>进入(enter) VariableDeclarator
<ul><li>进入(enter) Identifier
走完</li> <li>退出(exit) Identifier</li> <li>进入(enter) Literal
走完</li> <li>退出(exit) Literal</li></ul></li> <li>退出(exit) VariableDeclarator</li></ul></li> <li>退出(exit) VariableDeclaration
从上面的遍历过程你可以看出,一个节点遍历可以分为进入和离开两个阶段,
那么 babel 也是提供了这两个时机的回调函数给我们使用,分别是 enter 和 exit,
还有其它的回调函数,但是这里就不介绍了,感兴趣的大佬可以自行查看 babel 的介绍.</li></ul> <p>demo</p> <p>转换成箭头函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sourceCode <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
const fn = function () {
  return &quot;hello babel&quot;;
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Program&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 程序体</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 变量声明</span>
        <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">6</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 标识符</span>
              <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">6</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">8</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;identifierName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fn&quot;</span> <span class="token comment">// 变量名</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fn&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FunctionExpression&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 函数表达式</span>
              <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">11</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;generator&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;async&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token string-property property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BlockStatement&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 块语句</span>
                <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                  <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">22</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token punctuation">{</span>
                    <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ReturnStatement&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 返回语句</span>
                    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                        <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
                      <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                        <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">21</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string-property property">&quot;argument&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;StringLiteral&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 字符串字面量</span>
                      <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
                      <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
                      <span class="token string-property property">&quot;loc&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                          <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                          <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">8</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token string-property property">&quot;end&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                          <span class="token string-property property">&quot;line&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                          <span class="token string-property property">&quot;column&quot;</span><span class="token operator">:</span> <span class="token number">21</span>
                        <span class="token punctuation">}</span>
                      <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token string-property property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token string-property property">&quot;rawValue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello babel&quot;</span><span class="token punctuation">,</span>
                        <span class="token string-property property">&quot;raw&quot;</span><span class="token operator">:</span> <span class="token string">&quot;'hello babel'&quot;</span>
                      <span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token string-property property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello babel&quot;</span> <span class="token comment">// 值</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;const&quot;</span> <span class="token comment">// 类型</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在想把函数转换为箭头函数的形式;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> generate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sourceCode <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
const fn = function () {
  return &quot;hello babel&quot;;
}
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">FunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arrowFnExpression <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">arrowFunctionExpression</span><span class="token punctuation">(</span>
      path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>params<span class="token punctuation">,</span>
      path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>body
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>arrowFnExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">结果</span><span class="token operator">:</span> <span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;hello babel&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>遍历过程中 babel 给我们提供的一些参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  node                <span class="token comment">//  当前ast节点</span>
  parent              <span class="token comment">//  父节点ast节点</span>
  parentPath          <span class="token comment">//  父节点ast的path</span>
  <span class="token operator">...</span>

  <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>            <span class="token comment">//  获取某个属性的path</span>
  <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> node<span class="token punctuation">)</span>      <span class="token comment">//  设置某个属性的值</span>
  <span class="token function">replaceWith</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>   <span class="token comment">//  用某个节点替换当前节点</span>
  <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">//  移除当前节点</span>
  <span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">//  跳过当前节点的遍历</span>
  <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// 结束所有遍历</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    file              <span class="token comment">// file 对象</span>
    opts              <span class="token comment">// 插件的配置项</span>
<span class="token punctuation">}</span>
</code></pre></div><p>简单的移除 console 语句</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/types&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> generate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>

<span class="token keyword">const</span> sourceCode <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    console.log('hello babel')
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      types<span class="token punctuation">.</span><span class="token function">isIdentifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>object<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;console&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      types<span class="token punctuation">.</span><span class="token function">isIdentifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>property<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;log&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      path<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>结果:</p> <p>按需引入的简单讲解</p> <p>我们使用的组件库 element 或者 ant-design 都提供按需引入组件的 babel 插件,那么它的插件主要是做了什么事情来帮助我们来做到按需引入,从而减少我们打包的体积呢?
其实它就是在引入组件的时候,把库的名字具体到了库/组件;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/traverse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> generate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@babel/generator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>

<span class="token keyword">const</span> sourceCode <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import { Input } from 'element-ui'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> specifiers<span class="token punctuation">,</span> source <span class="token punctuation">}</span> <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
    source<span class="token punctuation">.</span>value <span class="token operator">=</span> specifiers<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      pre <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/lib/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cur<span class="token punctuation">.</span>imported<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> pre<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">结果</span><span class="token operator">:</span> <span class="token keyword">import</span> <span class="token punctuation">{</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;element-ui/lib/Input&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>实际场景</p> <p>好了,现在回来实际场景了.现在我们的管理台要进行中台切换,很多以前设计的页面都要重新设计(大改,基本废弃)这些页面可能多达十几个,但是它们有一个特点那就是我需要在开发环境查看,在其它环境不展示呢?
当前有,处理方法也有很多,比如可以在代码加入一些逻辑来处理.但是,我能不能制定一些标识,通过这些标识来说明这些无用的页面呢,从而达到在打包应用的时候压根不去打包这些页面呢?</p> <p>想法</p> <p>大家经常会在一些库的源码或者在使用的某些库的过程中,看到以下一些注释代码.
比如</p> <div class="language-js extra-class"><pre class="language-js"><code>webpack <span class="token comment">/*webpackChunkName:&quot;chunkName&quot; */</span>  生成指定名字模块
eslint <span class="token operator">/</span> <span class="token operator">*</span>eslint<span class="token operator">-</span>disable <span class="token operator">*</span><span class="token operator">/</span>                 关闭规则校验
teser <span class="token comment">/*@PURE*/</span>                     标识函数是纯函数
</code></pre></div><p>上面这种注释看似无用,其实却在背后默默的帮我们做了很多事情.那看到这里,你的想法是否和我一样,我能不能写一个属于我自己的注释,然后根据这些注释来标识一些无用的页面呢?答案也很显然.</p> <p>代码实现</p> <p>以插件的形式编写,使用插件的时候我们就不需要引入@babel/parser,@babel/generator...等插件.在我们导出的函数的参数中会有这些参数.</p> <div class="language-js extra-class"><pre class="language-js"><code>babel <span class="token operator">-</span> plugin <span class="token operator">-</span> remove <span class="token operator">-</span> development<span class="token punctuation">.</span>js<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleRemove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> path<span class="token punctuation">,</span> data<span class="token punctuation">,</span> removeParent <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> currentEnv <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> index <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>leadingComments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s{0,}environment\s{0,}:\s{0,}['|&quot;](.*)['|&quot;]\s{0,}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>leadingComments<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>leadingComments<span class="token punctuation">;</span>
    <span class="token keyword">const</span> matchList <span class="token operator">=</span>
      leadingComments <span class="token operator">&amp;&amp;</span>
      leadingComments<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span>
      leadingComments<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>matchList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// eslint-disable-next-line no-unused-vars</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>originValue<span class="token punctuation">,</span> matchValue<span class="token punctuation">]</span> <span class="token operator">=</span> matchList<span class="token punctuation">;</span>
      <span class="token keyword">const</span> envList <span class="token operator">=</span> matchValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;|&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> includeCurrentEnv <span class="token operator">=</span> envList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>currentEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>includeCurrentEnv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      removeParent <span class="token operator">?</span> path<span class="token punctuation">.</span>parentPath<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      path<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">types</span><span class="token operator">:</span> t <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> currentEnv <span class="token operator">=</span> <span class="token string">&quot;dev&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">MemberExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">.</span>parentPath<span class="token punctuation">.</span><span class="token function">isCallExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>object<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token function">handleRemove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>object<span class="token punctuation">.</span>arguments<span class="token punctuation">,</span>
            <span class="token literal-property property">removeParent</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            currentEnv<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleRemove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>arguments<span class="token punctuation">,</span> currentEnv <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">ObjectExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleRemove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          path<span class="token punctuation">,</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>properties<span class="token punctuation">,</span>
          <span class="token literal-property property">removeParent</span><span class="token operator">:</span> t<span class="token punctuation">.</span><span class="token function">isVariableDeclarator</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>parentPath<span class="token punctuation">)</span><span class="token punctuation">,</span>
          currentEnv<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/common/download&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;pdDownLoad&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 只需要在引入路由的时候添加/* environment: &quot;dev&quot; */即可</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* environment: &quot;dev&quot; */</span> <span class="token string">&quot;@/views/common/download&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&quot;/common/clip-image&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;pdClipImage&quot;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* environment: &quot;dev&quot; */</span> <span class="token string">&quot;@/views/common/clip-image&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> menus <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 这里的意思是,这个对象会在dev和test和uat的环境中存在,在其他环境会被销毁.</span>
    <span class="token comment">/* environment: &quot;dev|test|uat&quot; */</span>
    <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;el-icon-coin&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;公共页面&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">subMenu</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;自定义导出&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/common/download&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;pdDownload&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;图片生成&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/common/clip-image&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;pdClipImage&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 这里的意思是这个对象只会在dev环境中存在.</span>
    <span class="token comment">/* environment: &quot;dev&quot; */</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;社区团购门店&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/store/index/index&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;pdStore&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

babel<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;./babel-plugin/babel-plugin-remove-development.js&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// VUE_APP_ENV这里是你当前运行的环境或者是打包的环境,比如dev|test|uat|prod.因为我的项目中是用VUE_APP_ENV来区分环境的.</span>
        <span class="token literal-property property">currentEnv</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_ENV</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>这样的好处是,不需要在代码加一些逻辑判断,只需要通过注释就可以实现在 webpack 打包的时候就把标注了注释的节点给删除掉.以上内容如有错误,请大佬可以指出.</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li>https://zhuanlan.zhihu.com/p/85915575</li> <li>https://www.cnblogs.com/attilax/p/5963787.html</li> <li>https://blog.csdn.net/weixin_42436686/article/details/112515290</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/blog/element/element.html" class="prev">
        穿透更改element
      </a></span> <span class="next"><a href="/blog/blog/babel/babel-plugin-auto-report-error.html">
        babel-plugin-auto-report-error
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.4b9b75fb.js" defer></script><script src="/blog/assets/js/2.14ceba81.js" defer></script><script src="/blog/assets/js/9.b6e23a3a.js" defer></script>
  </body>
</html>
